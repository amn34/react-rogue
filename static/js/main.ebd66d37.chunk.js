(this["webpackJsonpreact-rouge"]=this["webpackJsonpreact-rouge"]||[]).push([[0],{20:function(t,e,a){t.exports=a(26)},26:function(t,e,a){"use strict";a.r(e);var i=a(5),r=a.n(i),o=a(17),n=a.n(o),s=a(8),l=a(0),c=a(1),h=function(){function t(){var e=this;Object(l.a)(this,t),this.observers=[],this.handleKeys=function(t){switch(t.preventDefault(),t.keyCode){case 37:e.broadcast("move",{x:-1,y:0});break;case 38:e.broadcast("move",{x:0,y:-1});break;case 39:e.broadcast("move",{x:1,y:0});break;case 40:e.broadcast("move",{x:0,y:1})}}}return Object(c.a)(t,[{key:"subscribe",value:function(t){this.observers.push(t)}},{key:"unsubscribe",value:function(t){this.observers=this.observers.filter((function(e){return e!==t}))}},{key:"broadcast",value:function(t,e){this.observers.forEach((function(a){return a(t,e)}))}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.handleKeys)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.handleKeys)}}]),t}(),u=a(18),y=a(4),d=a(3),f=a(19),b=function(){function t(e,a,i,r){Object(l.a)(this,t),this.x=e,this.y=a,this.size=i,this.attributes=Object(f.a)({},r)}return Object(c.a)(t,[{key:"action",value:function(t,e){console.log("Verb: ".concat(t))}},{key:"draw",value:function(t){t.fillStyle=this.attributes.color||"white",t.textBaseline="hanging",t.font="16px Helvetica",t.fillText(this.attributes.ascii,this.x*this.size+(this.attributes.offset?this.attributes.offset.x:0),this.y*this.size+(this.attributes.offset?this.attributes.offset.y:0))}}]),t}(),p=function(t){Object(y.a)(a,t);var e=Object(d.a)(a);function a(){var t;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).attributes={name:"Player",ascii:"@",maxHealth:10,health:10,attack:1,defense:0,gold:0},t}return Object(c.a)(a,[{key:"move",value:function(t,e){this.attributes.health<=0||(this.x+=t,this.y+=e)}},{key:"add",value:function(t,e){var a=1+Math.floor(2*Math.random());"Sword"===t.attributes.name?this.attributes.attack=this.attributes.attack+a:"Armor"===t.attributes.name?this.attributes.defense+=a:"Gold"===t.attributes.name?this.attributes.gold+=a:(a+=4,this.attributes.health+=a,this.attributes.maxHealth+=1,this.attributes.health>this.attributes.maxHealth&&(this.attributes.health=this.attributes.maxHealth)),e.addToHistory("You have picked up ".concat(t.attributes.name)),e.addToHistory("Power: ".concat(a))}},{key:"copyPlayer",value:function(){var t=new a;return Object.assign(t,this),t}}]),a}(b),v=function(){function t(e,a,i){Object(l.a)(this,t),this.width=e,this.height=a,this.tileSize=i,this.entities=[new p(0,0,16)],this.level=0,this.history=[],this.worldmap=new Array(this.width);for(var r=0;r<this.width;r++)this.worldmap[r]=new Array(this.height)}return Object(c.a)(t,[{key:"add",value:function(t){this.entities.push(t)}},{key:"remove",value:function(t){this.entities=this.entities.filter((function(e){return e!==t}))}},{key:"moveToSpace",value:function(t){for(var e=t.x;e<this.width;e++)for(var a=t.y;a<this.height;a++)if(0===this.worldmap[e][a]&&!this.getEntityAtLocation(e,a))return t.x=e,void(t.y=a)}},{key:"isWall",value:function(t,e){return void 0===this.worldmap[t]||void 0===this.worldmap[e]||1===this.worldmap[t][e]}},{key:"getEntityAtLocation",value:function(t,e){return this.entities.find((function(a){return a.x===t&&a.y===e}))}},{key:"movePlayer",value:function(t,e){var a=this.player.copyPlayer();a.move(t,e);var i=this.getEntityAtLocation(a.x,a.y);if(i)return console.log(i),void i.action("bump",this);this.isWall(a.x,a.y)?console.log("Way blocked at ".concat(a.x,":").concat(a.y,"!")):this.player.move(t,e)}},{key:"moveMonsters",value:function(t){var e=this;this.entities.filter((function(t){return"monster"===t.attributes.type})).forEach((function(a){var i=a.copyMonster(),r=e.chooseMonsterDirection(),o=r.x,n=r.y;i.move(o,n),console.log("move monster");var s=e.getEntityAtLocation(i.x,i.y);s!==e.player?s||e.isWall(i.x,i.y)||a.move(o,n):a.attackPlayer(t)}))}},{key:"chooseMonsterDirection",value:function(){var t=Math.floor(4*Math.random())+1;return 1===t?{x:1,y:0}:2===t?{x:-1,y:0}:3===t?{x:0,y:1}:4===t?{x:0,y:-1}:void 0}},{key:"createCellularMap",value:function(){var t=this,e=new u.a.Cellular(this.width,this.height,{connected:!0});e.randomize(.5);var a=function(e,a,i){0!==e&&0!==a&&e!==t.width-1&&a!==t.height-1?t.worldmap[e][a]=0===i?1:0:t.worldmap[e][a]=1};e.create(a),e.connect(a,1)}},{key:"draw",value:function(t){for(var e=0;e<this.width;e++)for(var a=0;a<this.height;a++)1===this.worldmap[e][a]&&this.drawWall(t,e,a);this.entities.forEach((function(e){e.draw(t)}))}},{key:"drawWall",value:function(t,e,a){t.fillStyle="#000",t.fillRect(e*this.tileSize,a*this.tileSize,this.tileSize,this.tileSize)}},{key:"addToHistory",value:function(t){this.history.push(t),this.history.length>6&&this.history.shift()}},{key:"player",get:function(){return this.entities[0]}}]),t}(),m=function(t){Object(y.a)(a,t);var e=Object(d.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(c.a)(a,[{key:"action",value:function(t,e){"bump"===t&&(console.log("Pickup",this),e.player.add(this,e),e.remove(this)),"drop"===t&&console.log("drop",this)}}]),a}(b),w=function(t){Object(y.a)(a,t);var e=Object(d.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(c.a)(a,[{key:"action",value:function(t,e){if("bump"===t){var a=e.player.attributes.attack-this.attributes.defense;a>0?(this.attributes.health-=a,e.addToHistory("Player attacks ".concat(this.attributes.name," for ").concat(a," damage!"))):e.addToHistory("You dealt no damage to ".concat(this.attributes.name)),this.attributes.health<=0?(e.addToHistory("".concat(this.attributes.name," dies!")),e.addToHistory("You collected 1 gold"),e.player.attributes.gold+=1,e.remove(this)):(e.addToHistory("".concat(this.attributes.name,"'s has ").concat(this.attributes.health," health")),this.attackPlayer(e),e.player.attributes.health<=0&&e.addToHistory("You have died!"))}}},{key:"attackPlayer",value:function(t){var e=this.attributes.attack-t.player.attributes.defense;e>0?(t.player.attributes.health-=e,t.addToHistory("You were attacked by ".concat(this.attributes.name," for ").concat(e," damage")),t.addToHistory("You have ".concat(t.player.attributes.health," health left"))):t.addToHistory("The monster did no damage")}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}},{key:"copyMonster",value:function(){var t=new a;return Object.assign(t,this),t}}]),a}(b),k=function(t){Object(y.a)(a,t);var e=Object(d.a)(a);function a(){var t;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).attributes={name:"Stair",color:"white",ascii:">",offset:{x:2,y:2}},t}return Object(c.a)(a,[{key:"action",value:function(t,e){if("bump"===t){e.level+=1,e.addToHistory("You move down the stairs..."),e.addToHistory("You have entered B".concat(e.level)),e.createCellularMap(),e.player.x=0,e.player.y=0,e.moveToSpace(e.player),e.entities=e.entities.filter((function(t){return t===e.player}));var a=new O(e);a.MonsterTable.forEach((function(t){t.health+=5*e.level,t.attack+=5*e.level,t.defense+=2*e.level,t.reward+=1*e.level})),a.spawnLoot(10),a.spawnMonsters(6),a.spawnStairs(),a.spawnShopKeeper()}}}]),a}(b),g=function(t){Object(y.a)(a,t);var e=Object(d.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(c.a)(a,[{key:"action",value:function(t,e){if("bump"===t){var a=this.attributes.num;0===a?(e.addToHistory("You purchased ".concat(e.player.attributes.gold," swords from Shopkeeper Kevin")),e.player.attributes.attack+=e.player.attributes.gold,e.player.attributes.gold=0):1===a?(e.addToHistory("You purchased ".concat(e.player.attributes.gold," armor from Shopkeeper Omri")),e.player.attributes.defense+=e.player.attributes.gold,e.player.attributes.gold=0):(e.addToHistory("Shopkeeper Joey stole all your gold!"),e.player.attributes.gold=0),e.remove(this)}}}]),a}(b);function x(t){return Math.floor(Math.random()*Math.floor(t))}var O=function(){function t(e){Object(l.a)(this,t),this.world=e,this.MonsterTable=[{type:"monster",name:"Ogre",color:"lightgrey",ascii:"O",offset:{x:2,y:3},health:5,attack:2,defense:0,reward:3},{type:"monster",name:"Snake",color:"lightgreen",ascii:"S",offset:{x:2,y:3},health:3,attack:2,defense:0,reward:2},{type:"monster",name:"Rat",color:"darkgrey",ascii:"R",offset:{x:2,y:3},health:2,attack:1,defense:0,reward:1},{type:"monster",name:"Penguin",color:"blue",ascii:"P",offset:{x:2,y:3},health:10,attack:3,defense:0,reward:6}],this.lootTable=[{type:"item",name:"Sword",color:"darkgrey",ascii:"/",offset:{x:6,y:3}},{type:"item",name:"Potion",color:"red",ascii:"!",offset:{x:6,y:3}},{type:"item",name:"Gold",color:"yellow",ascii:"$",offset:{x:3,y:3}},{type:"item",name:"Armor",color:"lightgrey",ascii:"#",offset:{x:4,y:3}}],this.shopTable=[{type:"shopkeeper",name:"Kevin",ascii:"Q",offset:{x:2,y:3},num:0},{type:"shopkeeper",name:"Omri",ascii:"Q",offset:{x:2,y:3},num:1},{type:"shopkeeper",name:"Joey",ascii:"Q",offset:{x:2,y:3},num:2}]}return Object(c.a)(t,[{key:"spawn",value:function(t,e){for(var a=0;a<t;a++){var i=e();this.world.add(i),this.world.moveToSpace(i)}}},{key:"spawnLoot",value:function(t){var e=this;this.spawn(t,(function(){return new m(x(e.world.width-1),x(e.world.height-1),e.world.tileSize,e.lootTable[x(e.lootTable.length)])}))}},{key:"spawnMonsters",value:function(t){var e=this;this.spawn(t,(function(){return new w(x(e.world.width-1),x(e.world.height-1),e.world.tileSize,e.MonsterTable[x(e.lootTable.length)])}))}},{key:"spawnShopKeeper",value:function(){var t=this;this.spawn(1,(function(){return new g(x(t.world.width-1),x(t.world.height-1),t.world.tileSize,t.shopTable[x(t.shopTable.length)])}))}},{key:"spawnStairs",value:function(){var t=new k(this.world.width-10,this.world.height-10,this.world.tileSize);this.world.add(t),this.world.moveToSpace(t)}}]),t}(),j=function(t){var e=t.width,a=t.height,o=t.tileSize,n=r.a.useRef(null),l=Object(i.useState)(new v(e,a,o)),c=Object(s.a)(l,2),u=c[0],y=c[1],d=new h,f=function(t,e){console.log("handle input: ".concat(t,":").concat(JSON.stringify(e)));var a=new v;Object.assign(a,u),a.movePlayer(e.x,e.y),a.moveMonsters(u),y(a)};return Object(i.useEffect)((function(){console.log("Create map");var t=new v;Object.assign(t,u),t.createCellularMap(),t.moveToSpace(u.player);var e=new O(t);e.spawnLoot(10),e.spawnMonsters(6),e.spawnStairs(),y(t)}),[]),Object(i.useEffect)((function(){return console.log("Bind input manager"),d.bindKeys(),d.subscribe(f),function(){d.unbindKeys(),d.unsubscribe(f)}})),Object(i.useEffect)((function(){console.log("Draw to the canvas");var t=n.current.getContext("2d");t.clearRect(0,0,e*o,a*o),u.draw(t,o)})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("ul",{style:{padding:"20px"}},r.a.createElement("li",{style:{display:"inline-center"}}," Log: "),r.a.createElement("li",null," -------------------------------"),u.history.map((function(t,e){return r.a.createElement("li",{key:e},t)}))),r.a.createElement("canvas",{ref:n,width:e*o,height:a*o,style:{border:"1px solid black",background:"DimGray",display:"block"}}),r.a.createElement("ul",{style:{listStyle:"none"}},r.a.createElement("h1",null," B",u.level),r.a.createElement("li",null," Health: ",u.player.attributes.health," / ",u.player.attributes.maxHealth),r.a.createElement("li",null," Attack: ",u.player.attributes.attack),r.a.createElement("li",null," Defense: ",u.player.attributes.defense),r.a.createElement("li",null," Gold: ",u.player.attributes.gold)))},S=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(j,{width:40,height:40,tileSize:16}))};n.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S,null)),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.ebd66d37.chunk.js.map